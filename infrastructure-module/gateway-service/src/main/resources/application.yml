server:
  port: 8080

spring:
  application:
    name: gateway-service
  # Redis配置
#  data:
#    redis:
#      host: ${REDIS_HOST:localhost}
#      port: ${REDIS_PORT:6379}
#      database: 0
#      timeout: 1000
#      lettuce:
#        shutdown-timeout: 100
#        pool:
#          max-active: 8
#          max-idle: 8
#          min-idle: 0
#          max-wait: -1
  cloud:
    # 启用bootstrap
    bootstrap:
      enabled: true
    gateway:
      discovery:
        locator:
          enabled: true  # Enable service discovery
          lower-case-service-id: true  # Service IDs in lowercase
      routes:
        - id: iam-service
          uri: lb://iam-service
          predicates:
            - Path=/api/iam/**
          filters:
            - StripPrefix=2

        # Add more route configurations as needed
    
    loadbalancer:
      ribbon:
        enabled: false  # Disable Ribbon since we're using Spring Cloud LoadBalancer
  # Configure logging
logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: INFO
    org.springframework.http.server.reactive: INFO
    org.springframework.web.reactive: INFO
    reactor.netty: INFO

# Management endpoints
#management:
#  endpoints:
#    web:
#      exposure:
#        include: "*"
#  endpoint:
#    health:
#      show-details: always

# Synapse 配置
synapse:
  cache:
    enabled: true
    default-strategy: "LOCAL_AND_REDIS"
    redis-cache:
      sentinel:
        enabled: true
        master: mymaster
        nodes:
          - 10.80.3.21:26379
          - 10.80.3.22:26379
          - 10.80.3.23:26379
          - 10.80.3.24:26379
          - 10.80.3.25:26379
      #      enabled: true
      #      connection:
      #        host: localhost
      #        port: 6379
      #        database: 0
      #        timeout: PT2S
      connection-timeout: PT5S
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: PT-1S
      enabled: true
  # Security配置
  security:
    # 是否启用安全模块
    enabled: true
    # 安全模式：STRICT（严格模式，所有请求都需要认证）、PERMISSIVE（宽松模式，部分请求可以匿名访问）、DISABLED（关闭模式，不进行安全控制）
    mode: PERMISSIVE
    # 白名单路径配置
    white-list:
      # 是否启用白名单
      enabled: true
      # 白名单路径列表（支持 Ant 风格路径匹配）
      paths:
        - /api/iam/auth/**   # 认证相关接口（原始路径，用于直接访问）
        - /oauth2/**         # OAuth2相关接口
        - /actuator/**       # 监控端点
        - /swagger-ui/**     # Swagger UI
        - /v3/api-docs/**    # API文档
        - /webjars/**        # 静态资源
        - /favicon.ico       # 网站图标
        - /error             # 错误页面
    # Token 配置
    token:
      # Token 前缀（用于 Authorization 请求头）
      prefix: "Bearer "
      # Token 查询参数名
      query-param: "token"
      # Authorization 请求头名称
      header-name: "Authorization"
      # X-Auth-Token 请求头名称（备用 token 传递方式）
      x-auth-token-header: "X-Auth-Token"
    # Gateway 签名配置（用于 Gateway 和微服务之间的签名验证）
    gateway-signature:
      # 是否启用 Gateway 签名验证
      enabled: true
      # Gateway 签名密钥（生产环境必须修改为强密钥）
      secret: "synapse-gateway-secret-key-change-in-production"
      # 签名有效期窗口（毫秒），默认 5 分钟，防止重放攻击
      validity-window: 300000
      # 是否启用用户上下文传递（启用后，Gateway 会将用户上下文编码到请求头，减少微服务的 Redis 查询）
      enable-context-passing: true
    # OAuth2配置（保留原有配置）
    oauth2:
      enabled: true
      clients:
        default:
          clientId: "synapse-client"
          clientSecret: "synapse-secret"
          allowUrl: "*"
          scope: "userinfo"
          isAutoMode: true
      resources:
        userinfo:
          resourceName: "用户信息"
          resourceCode: "userinfo"
          description: "用户基本信息资源"
  # Gateway配置
  gateway:
    # 语言环境配置
    locale:
      enabled: true                    # 是否启用语言环境处理
      default-locale: zh_CN           # 默认语言环境
      param-name: lang                # URL参数名
      log-locale: false               # 是否记录语言环境日志
      header-name: X-Locale           # 语言环境请求头名称
      strict-validation: true          # 是否严格验证语言环境格式
      allow-unknown-locales: true      # 是否允许未知语言环境